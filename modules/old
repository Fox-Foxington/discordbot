// Import necessary modules
const { MessageEmbed } = require('discord.js');

// Initialize ticket counter
let ticketCounter = 1;

// Function to create a ticket
async function createTicket(message) {
    try {
        // Generate ticket name with an ascending number
        const ticketName = `Ticket-${ticketCounter++}`;

        // Create a new ticket channel
        const channel = await message.guild.channels.create(ticketName, {
            type: 'text',
            permissionOverwrites: [
                {
                    id: message.guild.id, // @everyone role ID
                    deny: ['VIEW_CHANNEL'] // Deny VIEW_CHANNEL permission
                },
                {
                    id: message.author.id, // User who opened the ticket
                    allow: ['VIEW_CHANNEL', 'SEND_MESSAGES'] // Allow VIEW_CHANNEL and SEND_MESSAGES permission
                }
                // You can add more permission overwrites for moderators if needed
            ]
        });

        // Send a welcome message in the ticket channel
        const welcomeEmbed = new MessageEmbed()
            .setColor('#7289DA')
            .setTitle('Welcome to Your Ticket!')
            .setDescription('Please describe your issue and our staff will assist you shortly.')
            .setTimestamp();

        await channel.send({ embeds: [welcomeEmbed] });

        // Notify user that the ticket has been created
        await message.author.send(`Your ticket has been created in ${channel}`);

        console.log(`Ticket ${ticketName} created successfully.`);
    } catch (error) {
        console.error('Error creating ticket channel:', error);
    }
}

// Export the function to create a ticket
module.exports = { createTicket };